<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments :: head('RevPlay - Login')}"></head>

<body>
    <div id="auth-page" class="auth-container">
        <div class="auth-card">
            <h1>ðŸŽµ RevPlay</h1>
            <p class="subtitle">Your premium music experience</p>

            <div class="auth-tabs" th:style="${param.portal != null ? 'display:none' : ''}">
                <button class="auth-tab active" onclick="switchAuthType('user')">Listener</button>
                <button class="auth-tab" onclick="switchAuthType('artist')">Artist</button>
            </div>

            <div id="error-msg" class="error-msg"></div>
            <div id="success-msg" class="success-msg"></div>

            <!-- LOGIN FORM -->
            <form id="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="login-email" required placeholder="your@email.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="login-password" required placeholder="Enter password">
                </div>
                <button type="submit" class="btn btn-primary">Sign In</button>
                <div class="auth-link">
                    <a onclick="showForgotPassword()">Forgot Password?</a>
                </div>
                <div class="auth-link">
                    Don't have an account? <a th:href="@{/register(role=${param.role}, portal=${param.portal})}">Sign
                        Up</a>
                </div>
            </form>

            <!-- FORGOT PASSWORD FORM -->
            <form id="forgot-form" style="display:none" onsubmit="handleForgotPassword(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="forgot-email" placeholder="your@email.com">
                </div>
                <div id="security-q-container" style="display:none">
                    <div class="form-group">
                        <label id="security-q-label">Security Question</label>
                        <input type="text" id="forgot-answer" placeholder="Your answer">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="forgot-new-pass" placeholder="New password">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" id="forgot-btn">Get Security Question</button>
                <div class="auth-link">
                    <a onclick="toggleAuthForm('login')">Back to Login</a>
                </div>
            </form>
        </div>
    </div>

    <div th:replace="~{fragments :: scripts}"></div>
    <script>
        // Ensure auth type is set on load
        window.onload = () => {
            // Initial check
            if (localStorage.getItem('userId') || localStorage.getItem('artistId')) {
                window.location.href = '/home';
            }

            // Check for role param from welcome page
            const params = new URLSearchParams(window.location.search);
            const role = params.get('role');
            if (role === 'artist') {
                switchAuthType('artist');
            } else if (role === 'user') {
                switchAuthType('user');
            }
        };
    </script>
</body>

</html>